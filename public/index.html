<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Splitta.io</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÆ</text></svg>">
    
    <!-- Incluimos Tailwind CSS para un estilizado r√°pido -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Sign-In SDK -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- CSS con el nuevo estilo de Splitta.io -->
    <style>
        /* Definimos la animaci√≥n para el fondo de lava */
        @keyframes slide {
            from {
                background-position: 0 0;
            }
            to {
                background-position: -1920px 0;
            }
        }
        .background-animated {
            background-image: url('lava.png');
            background-size: 1920px 1080px;
            animation: slide 30s linear infinite;
            width: 100%;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
        }
        /* Estilos para el canvas del juego y de los c√≠rculos de fondo */
        #gameCanvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            max-width: 1200px;
            max-height: 800px;
            background-color: transparent;
            pointer-events: none;
        }
        /* Estilos para el c√≠rculo de personalizaci√≥n */
        #customize-canvas {
            background-color: transparent;
            border-radius: 9999px;
        }
        /* Estilos para los botones de Join Game con efecto "gamer" */
        .gamer-btn {
            background-image: linear-gradient(to right, #fcd34d, #f97316, #fcd34d);
            background-size: 200% auto;
            transition: background-position 0.5s ease-out, transform 0.2s ease-in-out;
            border: 2px solid rgba(0, 0, 0, 0.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .gamer-btn:hover {
            background-position: right center;
            transform: scale(1.02);
        }
    </style>
</head>
<body class="font-sans text-white relative overflow-hidden">
    <!-- Contenedor para el fondo de lava animado -->
    <div class="background-animated"></div>

    <!-- === SECCI√ìN PRINCIPAL DEL JUEGO === -->
    <div id="gameSection" class="relative z-10 p-4" style="display: block;">
        
        <!-- === TOP BAR === -->
        <nav class="flex items-center justify-between p-4 bg-transparent backdrop-blur-sm rounded-xl">
            <div class="text-xl font-bold">
                Bienvenido: <span class="text-yellow-400" id="userName">Nombre del jugador</span>
            </div>
            <button class="bg-yellow-400 text-black font-bold py-2 px-6 rounded-full shadow-lg hover:bg-yellow-500 transition-colors duration-300">
                Login
            </button>
        </nav>

        <!-- === PANELES PRINCIPALES === -->
        <main class="flex flex-col items-center justify-center h-[calc(100vh-100px)] p-4">
            <!-- Logo principal y nombre en el centro -->
            <div class="flex items-center justify-center mb-8">
                <img src="playstore-icon.jpg" alt="Logo de Splitta.io" class="w-24 h-24 mr-4">
                <span class="text-6xl font-bold italic text-white uppercase">SPLITTA.<span class="text-yellow-400">IO</span></span>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-4 w-full max-w-6xl mt-8">
                <!-- Columna izquierda: Leaderboard y Friends -->
                <div class="flex flex-col space-y-4">
                    <!-- Cuadro 1: Leaderboard -->
                    <div class="bg-gray-800 bg-opacity-70 backdrop-blur-md rounded-2xl p-6 shadow-xl border-2 border-gray-700 flex flex-col">
                        <h3 class="text-xl font-bold mb-4">Leaderboard</h3>
                        <ul class="w-full space-y-2">
                            <li class="flex justify-between items-center bg-gray-700 rounded-md p-2">
                                <span>1. aj</span>
                                <span class="text-green-400">$1,797.83</span>
                            </li>
                            <li class="flex justify-between items-center bg-gray-700 rounded-md p-2">
                                <span>2. gm_flatgrass</span>
                                <span class="text-yellow-400">$1,556.54</span>
                            </li>
                            <li class="flex justify-between items-center bg-gray-700 rounded-md p-2">
                                <span>3. 1dollar</span>
                                <span class="text-gray-400">$1,375.15</span>
                            </li>
                        </ul>
                        <button class="mt-4 w-full bg-transparent border-2 border-white text-white font-bold py-2 px-4 rounded-full hover:bg-white hover:text-black transition-colors duration-300">
                            View Full Leaderboard
                        </button>
                    </div>

                    <!-- Cuadro 4: Friends -->
                    <div class="bg-gray-800 bg-opacity-70 backdrop-blur-md rounded-2xl p-6 shadow-xl border-2 border-gray-700 flex flex-col">
                        <h3 class="text-xl font-bold mb-4">Friends</h3>
                        <div class="flex flex-col items-center justify-center">
                            <svg class="w-16 h-16 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>
                            <p class="text-gray-400 mt-2">No friends... add some!</p>
                        </div>
                        <button class="mt-4 w-full bg-gray-700 text-white font-bold py-2 px-4 rounded-full hover:bg-gray-600 transition-colors duration-300">
                            Add Friends
                        </button>
                    </div>
                </div>

                <!-- Columna central: Join Game -->
                <div class="flex flex-col space-y-4">
                    <!-- Cuadro 2: Join Game -->
                    <div class="bg-gray-800 bg-opacity-70 backdrop-blur-md rounded-2xl p-6 shadow-xl border-2 border-gray-700 flex flex-col items-center justify-center">
                        <div class="flex items-center mb-4">
                            <img src="https://placehold.co/40x40/000000/FFFFFF?text=?" alt="Icon" class="mr-2">
                            <input type="text" id="playerNameInput" placeholder="Login to set your name" class="flex-grow p-2 rounded-md bg-gray-700 text-white">
                            <button class="ml-2 p-2 rounded-md bg-gray-700 hover:bg-gray-600">
                                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-7 7A2 2 0 017.586 15H4v-3.586a2 2 0 01.586-1.414l7-7zM15 5l-7 7L4 12v4h4l7-7-4-4z" clip-rule="evenodd" fill-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="flex space-x-2 mb-4">
                            <button class="bg-yellow-400 text-black font-bold py-2 px-4 rounded-md hover:bg-yellow-500 transition-colors duration-300">$1</button>
                            <button class="bg-yellow-400 text-black font-bold py-2 px-4 rounded-md hover:bg-yellow-500 transition-colors duration-300">$5</button>
                            <button class="bg-yellow-400 text-black font-bold py-2 px-4 rounded-md hover:bg-yellow-500 transition-colors duration-300">$20</button>
                        </div>
                        <button id="startButton" class="w-full gamer-btn text-black font-bold py-4 px-4 rounded-full shadow-lg text-lg">
                            JOIN GAME
                        </button>
                        <div class="flex space-x-4 mt-4">
                            <button class="flex items-center bg-gray-700 text-white py-2 px-4 rounded-full hover:bg-gray-600 transition-colors duration-300">
                                <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zM8 7a1 1 0 112 0v4a1 1 0 11-2 0V7zm2-3a1 1 0 100 2 1 1 0 000-2z"></path></svg>
                                US
                            </button>
                            <button class="flex items-center bg-gray-700 text-white py-2 px-4 rounded-full hover:bg-gray-600 transition-colors duration-300">
                                <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zM8 7a1 1 0 112 0v4a1 1 0 11-2 0V7zm2-3a1 1 0 100 2 1 1 0 000-2z"></path></svg>
                                Browse Lobbies
                            </button>
                        </div>
                        <div class="mt-4 flex justify-around w-full">
                            <div>
                                <span class="block text-3xl font-bold">5</span>
                                <span class="text-sm text-gray-400">Players in Game</span>
                            </div>
                            <div>
                                <span class="block text-3xl font-bold text-yellow-400">$125,685</span>
                                <span class="text-sm text-gray-400">Global Player Winnings</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Columna derecha: Wallet y Customize -->
                <div class="flex flex-col space-y-4">
                    <!-- Cuadro 3: Wallet -->
                    <div class="bg-gray-800 bg-opacity-70 backdrop-blur-md rounded-2xl p-6 shadow-xl border-2 border-gray-700 flex flex-col items-center">
                        <h3 class="text-xl font-bold mb-4">Wallet</h3>
                        <div class="text-center mb-4">
                            <p class="text-4xl font-bold">$<span id="availableBalance">0.00</span></p>
                            <p class="text-sm text-gray-400">0.0000 SOL</p>
                        </div>
                        <div class="flex space-x-2">
                            <button id="addBalanceBtn" class="bg-green-500 text-white font-bold py-2 px-4 rounded-full hover:bg-green-600 transition-colors duration-300">
                                Add Funds
                            </button>
                            <button class="bg-purple-600 text-white font-bold py-2 px-4 rounded-full hover:bg-purple-700 transition-colors duration-300">
                                Cash Out
                            </button>
                        </div>
                    </div>

                    <!-- Cuadro 5: Customize -->
                    <div class="bg-gray-800 bg-opacity-70 backdrop-blur-md rounded-2xl p-6 shadow-xl border-2 border-gray-700 flex flex-col items-center">
                        <h3 class="text-xl font-bold mb-4">Customize</h3>
                        <div class="relative w-24 h-24 mb-4">
                            <canvas id="customize-canvas" width="96" height="96"></canvas>
                        </div>
                        <button class="mt-4 w-full bg-gray-700 text-white font-bold py-2 px-4 rounded-full hover:bg-gray-600 transition-colors duration-300">
                            Change Appearance
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Canvas para la animaci√≥n de los c√≠rculos -->
    <canvas id="gameCanvas"></canvas>

    <!-- === MODAL DE CASH OUT === -->
    <div id="cashOutModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
        <div class="modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #2c3e50; color: white; padding: 30px; border-radius: 15px; text-align: center; min-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
            <h3 style="color: #f39c12; margin-bottom: 20px; font-size: 24px;">üí∞ Cash Out</h3>
            <div style="font-size: 20px; margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                Valor actual: <strong style="color: #f39c12;">$<span id="currentValue">0.00</span></strong>
            </div>
            <hr style="border: 1px solid rgba(255,255,255,0.2); margin: 20px 0;">
            <div style="margin: 15px 0;">
                <p>Recibir√°s: <strong style="color: #2ecc71; font-size: 18px;">$<span id="cashOutAmount">0.00</span></strong> (90%)</p>
                <p>Fee del sistema: <span style="color: #e74c3c;">$<span id="feeAmount">0.00</span></span> (10%)</p>
            </div>
            <hr style="border: 1px solid rgba(255,255,255,0.2); margin: 20px 0;">
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="confirmCashOut" style="background: #2ecc71; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px;">‚úÖ Confirmar Cash Out</button>
                <button id="cancelCashOut" style="background: #e74c3c; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px;">‚ùå Continuar Jugando</button>
            </div>
        </div>
    </div>

    <!-- === RESULTADO DE CASH OUT === -->
    <div id="cashOutResult"></div>

    <!-- === MODAL RECARGA (NOWPayments) === -->
    <div id="topUpModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:2000;">
        <div style="position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); background:#1b2430; color:#fff; padding:24px; border-radius:12px; width: 420px; max-width: 95vw;">
            <h3 style="margin:0 0 12px; color:#FFD700;">‚ûï Add Funds (NOWPayments)</h3>
            <div style="font-size:13px; color:#aaa; margin-bottom:12px;">Pay with crypto, credited in USD to your balance.</div>
            <div style="display:flex; gap:8px; margin-bottom:12px;">
                <input id="topUpAmount" type="number" min="5" step="1" value="25" placeholder="$ Amount (USD)" style="flex:1; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.15); background:#243143; color:#fff;">
                <select id="topUpCurrency" style="width:140px; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.15); background:#243143; color:#fff;">
                    <option value="usdt">USDT</option>
                    <option value="usdc">USDC</option>
                    <option value="btc">BTC</option>
                    <option value="eth">ETH</option>
                    <option value="sol">SOL</option>
                </select>
            </div>
            <div id="topUpError" style="display:none; background:#e74c3c; padding:8px 10px; border-radius:6px; font-size:12px; margin-bottom:10px;"></div>
            <div id="topUpStepCreate" style="display:block;">
                <button id="topUpCreateBtn" style="width:100%; padding:12px; border:none; background:#2ECC71; color:#fff; border-radius:10px; font-weight:700; cursor:pointer;">Create Payment</button>
            </div>
            <div id="topUpStepPay" style="display:none;">
                <div style="margin:10px 0; font-size:13px; color:#ddd;">Send exactly <b><span id="topUpPayAmount">0</span></b> to address:</div>
                <div style="word-break:break-all; background:#0f1722; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.1); font-family:monospace;">
                    <span id="topUpPayAddress"></span>
                </div>
                <div style="display:flex; justify-content:center; margin:12px 0;">
                    <img id="topUpQr" src="" width="160" height="160" style="border-radius:8px; border:1px solid rgba(255,255,255,0.1);"/>
                </div>
                <div style="font-size:12px; color:#aaa;">Payment expires: <span id="topUpExpires"></span></div>
                <button id="topUpCheckBtn" style="margin-top:12px; width:100%; padding:10px; border:none; background:#3498db; color:#fff; border-radius:10px; font-weight:700; cursor:pointer;">I‚Äôve paid, Check Status</button>
            </div>
            <button id="topUpClose" style="margin-top:10px; width:100%; padding:8px; background:#95a5a6; border:none; color:#fff; border-radius:8px; cursor:pointer;">Close</button>
        </div>
    </div>
    
    <!-- Scripts de la l√≥gica del juego -->
    <!-- MANTENIDOS INTACTOS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.js"></script>
    <script src="game/js/render.js"></script>
    <script src="game/js/auth-manager.js"></script>
    <script src="game/js/betting-client.js"></script>
    <script src="game/js/canvas.js"></script>
    <script src="game/js/chat-client.js"></script>
    <script src="game/js/app-betting.js"></script>
    <script>
        window.onGoogleLibraryLoad = function() {
            console.log('üîê Google Sign-In SDK loaded');
            const apiBase = window.location.hostname === 'localhost'
                ? 'http://localhost:3000'
                : 'https://back.pruebatupanel.com';
            fetch(apiBase + '/api/config/google')
                .then(response => response.json())
                .then(config => {
                    if (config.clientId) {
                        initializeGoogleSignIn(config.clientId);
                    } else {
                        console.warn('‚ö†Ô∏è Google Client ID not configured');
                    }
                })
                .catch(error => {
                    console.error('‚ùå Failed to load Google config:', error);
                });
        };
        function initializeGoogleSignIn(clientId) {
            console.log('üîß Initializing Google Sign-In with client ID:', clientId.substring(0, 20) + '...');
            google.accounts.id.initialize({
                client_id: clientId,
                callback: handleGoogleSignIn
            });
            const googleBtn = document.getElementById('googleLoginBtn');
            if (googleBtn) {
                google.accounts.id.renderButton(googleBtn, {
                    theme: 'outline',
                    size: 'large',
                    text: 'signin_with',
                    shape: 'rectangular',
                    width: 250
                });
            }
        }
        async function handleGoogleSignIn(response) {
            console.log('üîê Google Sign-In response received');
            if (typeof authManager !== 'undefined') {
                const success = await authManager.loginWithGoogleToken(response.credential);
                if (success) {
                    console.log('‚úÖ Google login successful');
                } else {
                    console.error('‚ùå Google login failed');
                }
            } else {
                console.error('‚ùå AuthManager not loaded');
            }
        }
        window.addEventListener('error', function(e) {
            console.error('üö® Global error:', e.error);
            const errorDiv = document.getElementById('errorMessage');
            if (errorDiv) {
                errorDiv.textContent = 'Error: ' + (e.message || 'Unknown error');
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            }
        });
        if (window.location.hostname === 'localhost') {
            window.debugBetting = {
                checkGlobal: () => console.log('Global:', typeof global !== 'undefined' ? global : 'undefined'),
                checkAuth: () => console.log('AuthManager:', typeof AuthManager !== 'undefined' ? 'loaded' : 'missing'),
                forceLogin: () => {
                    if (typeof authManager !== 'undefined') {
                        authManager.devLogin();
                    } else {
                        console.log('‚ùå AuthManager not available');
                    }
                },
                showElements: () => {
                    console.log('Elements:', {
                        devLoginBtn: !!document.getElementById('devLoginBtn'),
                        gameSection: !!document.getElementById('gameSection'),
                        canvas: !!document.getElementById('cvs')
                    });
                },
                testGoogleLogin: () => {
                    if (typeof google !== 'undefined') {
                        google.accounts.id.prompt();
                    } else {
                        console.log('‚ùå Google SDK not loaded');
                    }
                }
            };
            console.log('üîß Development mode - Use window.debugBetting for helpers');
        }
    </script>
    <script>
        if (typeof google === 'undefined') {
            console.log('‚è≥ Waiting for Google SDK to load...');
        } else {
            console.log('‚úÖ Google SDK already loaded');
            window.onGoogleLibraryLoad();
        }
    </script>
    
    <!-- Script para las animaciones de los c√≠rculos -->
    <script>
        window.onload = function() {
            // --- Animaci√≥n de los c√≠rculos en el fondo ---
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            let circles = [];
            let lastSpawn = Date.now();
            const maxCircles = 30;

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            class Circle {
                constructor(x, y, radius, color, vx, vy) {
                    this.x = x;
                    this.y = y;
                    this.radius = radius;
                    this.color = color;
                    this.vx = vx;
                    this.vy = vy;
                    this.opacity = 0;
                    this.fadeInSpeed = 0.02;
                }

                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.globalAlpha = this.opacity;
                    ctx.fillStyle = this.color;
                    ctx.fill();
                    ctx.closePath();
                    ctx.globalAlpha = 1;
                }

                update() {
                    if (this.opacity < 0.7) {
                        this.opacity += this.fadeInSpeed;
                    }

                    this.x += this.vx;
                    this.y += this.vy;

                    if (this.x + this.radius > canvas.width || this.x - this.radius < 0) {
                        this.vx *= -1;
                    }
                    if (this.y + this.radius > canvas.height || this.y - this.radius < 0) {
                        this.vy *= -1;
                    }
                }
            }

            function getRandomColor() {
                const letters = '0123456789ABCDEF';
                let color = '#';
                for (let i = 0; i < 6; i++) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                return color;
            }

            function createCircle() {
                const radius = Math.random() * 20 + 10;
                const x = Math.random() * (canvas.width - 2 * radius) + radius;
                const y = Math.random() * (canvas.height - 2 * radius) + radius;
                const vx = (Math.random() - 0.5) * 3;
                const vy = (Math.random() - 0.5) * 3;
                const color = getRandomColor();
                circles.push(new Circle(x, y, radius, color, vx, vy));
            }

            for (let i = 0; i < 15; i++) {
                createCircle();
            }

            function animate() {
                requestAnimationFrame(animate);
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                for (let i = circles.length - 1; i >= 0; i--) {
                    const circle1 = circles[i];
                    circle1.update();
                    circle1.draw();

                    for (let j = circles.length - 1; j >= 0; j--) {
                        if (i === j) continue;
                        const circle2 = circles[j];
                        
                        const dx = circle1.x - circle2.x;
                        const dy = circle1.y - circle2.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);

                        if (distance < circle1.radius + circle2.radius) {
                            if (circle1.radius > circle2.radius) {
                                circle1.radius += circle2.radius * 0.1;
                                circles.splice(j, 1);
                            } else {
                                circle2.radius += circle1.radius * 0.1;
                                circles.splice(i, 1);
                                break;
                            }
                        }
                    }
                }

                if (circles.length < maxCircles && (Date.now() - lastSpawn > 500)) {
                    createCircle();
                    lastSpawn = Date.now();
                }
            }
            animate();

            // --- Animaci√≥n del c√≠rculo de personalizaci√≥n ---
            const customizeCanvas = document.getElementById('customize-canvas');
            const customizeCtx = customizeCanvas.getContext('2d');
            const flagSvgs = [
                `<path d="M0 0h20v20H0z" fill="#0a3161"></path><path d="M0 0h20v10H0z" fill="#b10b0e"></path><path d="M0 0h8v10H0z" fill="#fff"></path><path d="M1 1v8h6V1H1zm1.5 1h3v2h-3v-2zm0 3h3v2h-3v-2z" fill="#0a3161"></path>`, // USA
                `<path d="M0 0h20v20H0z" fill="#00247d"></path><path d="M0 0l20 20M20 0L0 20" stroke="#fff" stroke-width="2.5"></path><path d="M0 10h20M10 0v20" stroke="#cf142b" stroke-width="1.5"></path>`, // UK
                `<path fill="#fff" d="M0 0h20v20H0z"/><path fill="#c8102e" d="M0 0h20v10H0z"/><path fill="#000042" d="M0 10h20v10H0z"/>`, // Japan
                `<path d="M0 0h20v20H0z" fill="#009246"/><path d="M0 0h20v13.333H0z" fill="#fff"/><path d="M0 0h20v6.667H0z" fill="#ce2b37"/>` // Italy
            ];

            let flagIndex = 0;
            const flagChangeInterval = 2000;
            let lastFlagChange = Date.now();

            class CustomizeCircle {
                constructor(x, y, radius, color, vx, vy) {
                    this.x = x;
                    this.y = y;
                    this.radius = radius;
                    this.color = color;
                    this.vx = vx;
                    this.vy = vy;
                    this.flagSvg = flagSvgs[flagIndex];
                }

                draw() {
                    customizeCtx.save();
                    customizeCtx.beginPath();
                    customizeCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    customizeCtx.fillStyle = this.color;
                    customizeCtx.fill();
                    customizeCtx.closePath();
                    
                    const flagImage = new Image();
                    flagImage.onload = () => {
                        customizeCtx.drawImage(flagImage, this.x - this.radius / 2, this.y - this.radius / 2, this.radius, this.radius);
                        customizeCtx.restore();
                    };
                    flagImage.src = `data:image/svg+xml;base64,${btoa(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">${this.flagSvg}</svg>`)}`;
                }

                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    if (this.x + this.radius > customizeCanvas.width || this.x - this.radius < 0) {
                        this.vx *= -1;
                    }
                    if (this.y + this.radius > customizeCanvas.height || this.y - this.radius < 0) {
                        this.vy *= -1;
                    }

                    if (Date.now() - lastFlagChange > flagChangeInterval) {
                        flagIndex = (flagIndex + 1) % flagSvgs.length;
                        this.flagSvg = flagSvgs[flagIndex];
                        lastFlagChange = Date.now();
                    }
                }
            }

            const customCircle = new CustomizeCircle(
                customizeCanvas.width / 2,
                customizeCanvas.height / 2,
                customizeCanvas.width / 3,
                getRandomColor(),
                (Math.random() - 0.5) * 1,
                (Math.random() - 0.5) * 1
            );

            function animateCustomize() {
                requestAnimationFrame(animateCustomize);
                customizeCtx.clearRect(0, 0, customizeCanvas.width, customizeCanvas.height);
                customCircle.update();
                customCircle.draw();
            }
            animateCustomize();
        };
    </script>
</body>
</html>
